<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{tituloDocumento}} - {{fornecedor.nome}}</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Helvetica', 'Arial', sans-serif;
      color: #333;
      font-size: 10.8px;
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transform: scale(0.9);
      transform-origin: top left;
      width: 111.11%;
    }

    .content-wrapper { flex: 1; padding-bottom: 63px; }
    .pdf-content { padding: 0 9px 9px 9px; }
    .cards-wrapper { display: flex; flex-direction: column; gap: 6px; }

    .card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background-color: #ffffff;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.08);
      margin-bottom: 6px;
    }

    /*
      Regras de paginação (Chromium/Puppeteer):
      - Evitar "título órfão" (header em uma página e conteúdo só na próxima)
      - Permitir que o conteúdo (especialmente tabelas) quebre de forma natural
    */
    @media print {
      .card-fornecedor {
        break-inside: avoid;
        page-break-inside: avoid;
      }

      /* Não deixar o header ficar sozinho no fim da página */
      .card-header {
        break-after: avoid;
        page-break-after: avoid;
      }

      /* Manter o primeiro bloco do body junto com o header quando possível */
      .card-header + .card-body {
        break-before: avoid;
        page-break-before: avoid;
        break-inside: auto;
        page-break-inside: auto;
      }

      /* Permitir quebra natural em conteúdos longos */
      .card-body {
        break-inside: auto;
        page-break-inside: auto;
      }

      /* Tabelas: repetir cabeçalho e permitir quebra por linhas */
      thead { display: table-header-group; }
      tfoot { display: table-footer-group; }
      tr { break-inside: avoid; page-break-inside: avoid; }
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 7px;
      background-color: #059669;
      color: #ffffff;
      padding: 6px 10px;
      border-radius: 7px 7px 0 0;
      border-bottom: 2px solid #047857;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.3px;
      text-transform: uppercase;
    }

    .card-body { padding: 8px 10px; }

    .kv {
      display: grid;
      grid-template-columns: 140px 1fr;
      gap: 6px 10px;
      align-items: baseline;
      margin-bottom: 8px;
    }
    .k { color: #64748b; font-weight: 700; font-size: 10px; text-transform: uppercase; letter-spacing: 0.4px; }
    .v { color: #0f172a; font-weight: 700; }

    .areas-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    .area-pill {
      border: 1px solid #bbf7d0;
      background: #f0fdf4;
      color: #047857;
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 10px;
      font-weight: 700;
      white-space: nowrap;
    }

    .note {
      margin-top: 8px;
      border: 1px solid #bae6fd;
      background: #f0f9ff;
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 10px;
      color: #0f172a;
    }
    .note .i {
      display: inline-flex;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 800;
      background: #0ea5e9;
      color: #fff;
      margin-right: 6px;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 10px;
    }
    .table th, .table td {
      border: 1px solid #e5e7eb;
      padding: 6px 6px;
      vertical-align: top;
    }
    .table th {
      background: #f9fafb;
      color: #334155;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      font-size: 9px;
    }
    .text-right { text-align: right; }
    .text-center { text-align: center; }

    .subsection-title {
      margin: 10px 0 6px 0;
      font-size: 11px;
      font-weight: 900;
      color: #047857;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .totals-row td {
      background: #f0fdf4;
      font-weight: 900;
      color: #065f46;
    }

    .status-pill {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 9px;
      font-weight: 900;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #334155;
      text-transform: uppercase;
      letter-spacing: 0.2px;
      white-space: nowrap;
    }
    .status-PAGO { background: #f0fdf4; border-color: #bbf7d0; color: #047857; }
    .status-PENDENTE, .status-PROCESSANDO { background: #fffbeb; border-color: #fde68a; color: #92400e; }

    /* Estilos do Cabeçalho Reutilizável - Layout Profissional */
    .pdf-header {
      background-color: #ffffff;
      border-bottom: 3px solid #059669;
      padding: 22px 20px 12px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      page-break-inside: avoid;
    }

    .header-top {
      display: table;
      width: 100%;
      table-layout: fixed;
      margin-bottom: 10px;
    }

    .header-logo,
    .header-center,
    .header-qualificacao {
      display: table-cell;
      vertical-align: middle;
    }

    /* Logo à Esquerda */
    .header-logo {
      width: 180px;
      padding-right: 15px;
    }

    .logo-img {
      max-width: 180px;
      max-height: 80px;
      width: auto;
      height: auto;
      object-fit: contain;
      display: block;
    }

    .logo-placeholder {
      width: 180px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f3f4f6;
      border: 1px dashed #d1d5db;
      border-radius: 4px;
    }

    .logo-text {
      font-size: 14px;
      color: #6b7280;
      font-weight: 600;
      text-align: center;
    }

    /* Nome da Empresa no Centro */
    .header-center {
      text-align: center;
      padding: 0 20px;
      vertical-align: middle;
    }

    .header-center h1.empresa-nome {
      font-size: 24px;
      margin: 0 0 5px 0;
      font-weight: bold;
      color: #059669;
      text-transform: uppercase;
      letter-spacing: 1px;
      line-height: 1.2;
    }

    .header-center p.empresa-razao-social {
      font-size: 12px;
      margin: 0;
      color: #6b7280;
      font-style: italic;
      line-height: 1.3;
    }

    /* Qualificação da Empresa à Direita */
    .header-qualificacao {
      width: 220px;
      text-align: right;
      padding-left: 15px;
      vertical-align: top;
    }

    .qualificacao-item {
      margin-bottom: 6px;
      line-height: 1.4;
    }

    .qualificacao-item:last-child {
      margin-bottom: 0;
    }

    .qualificacao-value {
      font-size: 10px;
      color: #6b7280;
      font-weight: 600;
      display: block;
      word-wrap: break-word;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  {{!-- Cabeçalho Reutilizável --}}
  {{> header}}

  <div class="content-wrapper">
    <div class="pdf-content">
      <div class="cards-wrapper">

        <!-- Cabeçalho interno -->
        <div class="card card-fornecedor">
          <div class="card-header">
            <div class="card-title">{{tituloDocumento}}</div>
            <div style="font-size: 10px; font-weight: 700;">
              Gerado em: {{dataGeracaoFormatada}}
            </div>
          </div>
          <div class="card-body">
            <!-- Informações Principais em Grid -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 12px;">
              <!-- Fornecedor -->
              <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 10px;">
                <div style="font-size: 9px; color: #64748b; font-weight: 800; text-transform: uppercase; margin-bottom: 4px; letter-spacing: 0.5px;">Fornecedor</div>
                <div style="font-size: 13px; color: #0f172a; font-weight: 900;">{{fornecedor.nome}}</div>
              </div>
              
              <!-- Período -->
              {{#if periodo}}
              <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px; padding: 10px;">
                <div style="font-size: 9px; color: #64748b; font-weight: 800; text-transform: uppercase; margin-bottom: 4px; letter-spacing: 0.5px;">Período das Colheitas</div>
                <div style="font-size: 13px; color: #0f172a; font-weight: 900;">{{periodo.dataInicio}} a {{periodo.dataFim}}</div>
              </div>
              {{/if}}
            </div>

            <!-- Estatísticas Gerais -->
            {{#if estatisticasGerais}}
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 12px; padding: 12px; background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%); border-radius: 8px; border: 2px solid #10b981;">
              <div style="text-align: center;">
                <div style="font-size: 8px; color: #064e3b; font-weight: 800; text-transform: uppercase; margin-bottom: 3px; letter-spacing: 0.5px;">Total Colheitas</div>
                <div style="font-size: 18px; font-weight: 900; color: #059669;">{{estatisticasGerais.totalColheitas}}</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 8px; color: #064e3b; font-weight: 800; text-transform: uppercase; margin-bottom: 3px; letter-spacing: 0.5px;">Culturas</div>
                <div style="font-size: 18px; font-weight: 900; color: #059669;">{{estatisticasGerais.totalCulturas}}</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 8px; color: #064e3b; font-weight: 800; text-transform: uppercase; margin-bottom: 3px; letter-spacing: 0.5px;">Frutas</div>
                <div style="font-size: 18px; font-weight: 900; color: #059669;">{{estatisticasGerais.totalFrutas}}</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 8px; color: #064e3b; font-weight: 800; text-transform: uppercase; margin-bottom: 3px; letter-spacing: 0.5px;">Áreas</div>
                <div style="font-size: 18px; font-weight: 900; color: #059669;">{{estatisticasGerais.totalAreas}}</div>
              </div>
            </div>
            {{/if}}

            <!-- Áreas do Fornecedor -->
            <div style="background: #fffbeb; border: 1px solid #fde68a; border-radius: 6px; padding: 10px;">
              <div style="font-size: 9px; color: #78716c; font-weight: 800; text-transform: uppercase; margin-bottom: 6px; letter-spacing: 0.5px;">Áreas do Fornecedor no Relatório</div>
              <div class="areas-list">
                {{#each areas}}
                  <span class="area-pill">{{nome}} • {{#if ha}}{{ha}} ha{{else}}ha N/I{{/if}}</span>
                {{/each}}
              </div>
            </div>

            {{#if aplicarFiltros}}
              <div class="note" style="margin-top: 10px;">
                <span class="i">i</span>
                Este PDF foi gerado respeitando os filtros aplicados no modal.
              </div>
            {{/if}}
          </div>
        </div>

        <!-- Resumo por cultura/fruta (Estatísticas) -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">Resumo Estatístico por Cultura e Fruta</div>
          </div>
          <div class="card-body">
            {{#each resumo}}
              <!-- Subseção por Cultura/Fruta - permite quebra entre frutas -->
              <div style="margin-bottom: 14px; page-break-inside: avoid; page-break-after: auto;">
                <!-- Cabeçalho da Fruta -->
                <div style="background-color: #f8fafc; border: 2px solid #059669; border-radius: 8px; padding: 8px 10px; margin-bottom: 8px;">
                  <!-- Nome da Cultura e Fruta -->
                  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                    <div style="font-weight: 900; color: #059669; font-size: 11px; text-transform: uppercase;">{{cultura}}</div>
                    <div style="font-weight: 900; color: #0f172a; font-size: 12px;">• {{fruta}}</div>
                  </div>
                  
                  <!-- Status Claro e Intuitivo com Quantidades -->
                  <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                    <!-- STATUS DE COMPRA -->
                    {{#if colheitasPrecificadas}}
                      {{#if colheitasNaoPrecificadas}}
                        <!-- Tem algumas precificadas e algumas não -->
                        <div style="background: #ecfdf5; border: 1px solid #a7f3d0; border-radius: 4px; padding: 3px 8px; font-size: 8px; color: #047857; font-weight: 700;">
                          ✓ COMPRA: {{colheitasPrecificadas}} precificada(s)
                        </div>
                        <div style="background: #fef3c7; border: 1px solid #fde68a; border-radius: 4px; padding: 3px 8px; font-size: 8px; color: #92400e; font-weight: 700;">
                          ⏳ COMPRA: {{colheitasNaoPrecificadas}} aguardando precificação
                        </div>
                      {{else}}
                        <!-- Todas precificadas -->
                        <div style="background: #ecfdf5; border: 1px solid #a7f3d0; border-radius: 4px; padding: 3px 8px; font-size: 8px; color: #047857; font-weight: 700;">
                          ✓ COMPRA: Todas as colheitas foram precificadas
                        </div>
                      {{/if}}
                    {{else}}
                      <!-- Nenhuma precificada -->
                      <div style="background: #fef3c7; border: 1px solid #fde68a; border-radius: 4px; padding: 3px 8px; font-size: 8px; color: #92400e; font-weight: 700;">
                        ⏳ COMPRA: {{colheitasNaoPrecificadas}} aguardando precificação
                      </div>
                    {{/if}}
                    
                    <!-- STATUS DE VENDA -->
                    {{#if temFaltaVenda}}
                      <!-- Tem compra mas não tem venda -->
                      <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 4px; padding: 3px 8px; font-size: 8px; color: #991b1b; font-weight: 700;">
                        ⚠ VENDA: {{colheitasPrecificadas}} aguardando precificação
                      </div>
                    {{else}}
                      {{#if colheitasPrecificadas}}
                        <!-- Tem compra E tem venda -->
                        <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 4px; padding: 3px 8px; font-size: 8px; color: #15803d; font-weight: 700;">
                          ✓ VENDA: Todas as colheitas foram precificadas
                        </div>
                      {{else}}
                        <!-- Não tem compra E não tem venda -->
                        <div style="background: #fef3c7; border: 1px solid #fde68a; border-radius: 4px; padding: 3px 8px; font-size: 8px; color: #92400e; font-weight: 700;">
                          ⏳ VENDA: {{colheitasNaoPrecificadas}} aguardando precificação
                        </div>
                      {{/if}}
                    {{/if}}
                  </div>
                </div>

                <!-- Grid de Estatísticas - PRIMEIRA LINHA -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 6px;">
                  
                  <!-- Card: Quantidade Total Colhida -->
                  <div style="background-color: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px; padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: #64748b; font-weight: 700; margin-bottom: 4px; text-transform: uppercase;">TOTAL COLHIDO</div>
                    <div style="display: flex; flex-direction: column; gap: 3px; align-items: center;">
                      {{#each quantidadesPorUnidade}}
                        <div style="display: flex; flex-direction: column; align-items: center;">
                          <div style="font-size: 16px; font-weight: 900; color: #0f172a; line-height: 1;">{{quantidade}}</div>
                          <div style="font-size: 8px; color: #64748b; margin-top: 1px;">{{unidade}}</div>
                        </div>
                      {{/each}}
                    </div>
                  </div>

                  <!-- Card: Quantidade Precificada (Compra) -->
                  <div style="background-color: #ecfdf5; border: 1px solid #a7f3d0; border-radius: 6px; padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: #64748b; font-weight: 700; margin-bottom: 4px; text-transform: uppercase;">QTDE PRECIFICADA</div>
                    {{#if quantidadesPorUnidadePrecificada.length}}
                      <div style="display: flex; flex-direction: column; gap: 3px; align-items: center;">
                        {{#each quantidadesPorUnidadePrecificada}}
                          <div style="display: flex; flex-direction: column; align-items: center;">
                            <div style="font-size: 16px; font-weight: 900; color: #047857; line-height: 1;">{{quantidade}}</div>
                            <div style="font-size: 8px; color: #064e3b; margin-top: 1px;">{{unidade}}</div>
                          </div>
                        {{/each}}
                      </div>
                    {{else}}
                      <div style="font-size: 14px; color: #9ca3af;">-</div>
                    {{/if}}
                    <div style="font-size: 7px; color: #166534; margin-top: 4px;">Compra ao fornecedor</div>
                  </div>

                  <!-- Card: Quantidade NÃO Precificada (Compra) -->
                  <div style="background-color: #fefce8; border: 1px solid #fef08a; border-radius: 6px; padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: #64748b; font-weight: 700; margin-bottom: 4px; text-transform: uppercase;">SEM PRECIFICAÇÃO</div>
                    {{#if quantidadesPorUnidadeNaoPrecificada.length}}
                      <div style="display: flex; flex-direction: column; gap: 3px; align-items: center;">
                        {{#each quantidadesPorUnidadeNaoPrecificada}}
                          <div style="display: flex; flex-direction: column; align-items: center;">
                            <div style="font-size: 16px; font-weight: 900; color: #a16207; line-height: 1;">{{quantidade}}</div>
                            <div style="font-size: 8px; color: #713f12; margin-top: 1px;">{{unidade}}</div>
                          </div>
                        {{/each}}
                      </div>
                    {{else}}
                      <div style="font-size: 14px; color: #9ca3af;">-</div>
                    {{/if}}
                    <div style="font-size: 7px; color: #854d0e; margin-top: 4px;">Aguardando precificação</div>
                  </div>

                  <!-- Card: Valor Unitário Médio de Compra -->
                  <div style="background-color: #fef3c7; border: 1px solid #fde68a; border-radius: 6px; padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: #64748b; font-weight: 700; margin-bottom: 4px; text-transform: uppercase;">VU MÉDIO COMPRA</div>
                    <div style="font-size: 16px; font-weight: 900; color: #92400e;">{{valorUnitarioMedioCompra}}</div>
                    <div style="font-size: 7px; color: #78716c; margin-top: 4px; font-style: italic;">Base: colheitas precificadas</div>
                  </div>

                </div>

                <!-- Grid de Estatísticas - SEGUNDA LINHA -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;">
                  
                  <!-- Card: Valor Pago ao Fornecedor -->
                  <div style="background-color: #f0fdf4; border: 2px solid #22c55e; border-radius: 6px; padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: #64748b; font-weight: 700; margin-bottom: 4px; text-transform: uppercase;">PAGO AO FORNECEDOR</div>
                    <div style="font-size: 18px; font-weight: 900; color: #15803d;">{{compraPago}}</div>
                    <div style="font-size: 7px; color: #166534; margin-top: 4px;">✓ Pagamento efetuado</div>
                  </div>

                  <!-- Card: Valor Precificado (Aguardando Pagamento) -->
                  <div style="background-color: #fffbeb; border: 2px solid #fbbf24; border-radius: 6px; padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: #64748b; font-weight: 700; margin-bottom: 4px; text-transform: uppercase;">AGUARDANDO PAGAMENTO</div>
                    <div style="font-size: 18px; font-weight: 900; color: #d97706;">{{compraPrecificado}}</div>
                    <div style="font-size: 7px; color: #92400e; margin-top: 4px;">⏳ Pendente/Processando</div>
                  </div>

                  <!-- Card: Valor Total de Venda (Cliente) -->
                  <div style="background-color: #ecfdf5; border: 2px solid #10b981; border-radius: 6px; padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: #64748b; font-weight: 700; margin-bottom: 4px; text-transform: uppercase;">VENDA AO CLIENTE</div>
                    <div style="font-size: 18px; font-weight: 900; color: #059669;">{{vendaTotal}}</div>
                    <div style="font-size: 7px; color: #047857; margin-top: 4px;">Valor nos pedidos</div>
                  </div>

                </div>
              </div>

              {{#unless @last}}
                <div style="border-top: 1px dashed #e2e8f0; margin: 16px 0;"></div>
              {{/unless}}
            {{/each}}
          </div>
        </div>

        <!-- Tabela: colheitas precificadas (compra) -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">Colheitas Precificadas (Compra do Fornecedor)</div>
          </div>
          <div class="card-body">
            {{#each tabelas.precificadas}}
              <!-- Cabeçalho Cultura/Fruta -->
              <div style="background: linear-gradient(135deg, #059669 0%, #047857 100%); border-radius: 8px; padding: 10px 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                <div style="background-color: rgba(255, 255, 255, 0.2); border-radius: 6px; padding: 4px 8px;">
                  <span style="color: #ffffff; font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;">CULTURA</span>
                </div>
                <div style="color: #ffffff; font-size: 11px; font-weight: 900; text-transform: uppercase;">{{cultura}}</div>
                <div style="width: 2px; height: 16px; background-color: rgba(255, 255, 255, 0.3);"></div>
                <div style="background-color: rgba(255, 255, 255, 0.2); border-radius: 6px; padding: 4px 8px;">
                  <span style="color: #ffffff; font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;">FRUTA</span>
                </div>
                <div style="color: #ffffff; font-size: 11px; font-weight: 900;">{{fruta}}</div>
              </div>

              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 80px;">Pedido</th>
                    <th style="width: 140px;">Área</th>
                    <th style="width: 75px;">Data</th>
                    <th style="width: 100px;" class="text-right">Quantidade</th>
                    <th style="width: 90px;" class="text-right">VU Compra</th>
                    <th style="width: 90px;" class="text-right">Total Compra</th>
                    <th style="width: 80px;" class="text-center">Status</th>
                    <th style="width: 90px;" class="text-right">Venda</th>
                  </tr>
                </thead>
                <tbody>
                  {{#each linhas}}
                    <tr>
                      <td><strong>#{{pedido}}</strong></td>
                      <td>{{area}}</td>
                      <td>{{dataColheita}}</td>
                      <td class="text-right"><strong>{{quantidade}}</strong> {{unidade}}</td>
                      <td class="text-right">{{valorUnitarioCompra}}</td>
                      <td class="text-right">{{valorTotalCompra}}</td>
                      <td class="text-center"><span class="status-pill status-{{statusCompra}}">{{statusCompra}}</span></td>
                      <td class="text-right">{{valorVenda}}</td>
                    </tr>
                  {{/each}}
                  <tr class="totals-row">
                    <td colspan="3" style="text-align: right; font-weight: 800;">TOTAL POR UNIDADE:</td>
                    <td colspan="5">
                      {{#each totaisPorUnidade}}
                        <span style="margin-left: 10px; font-weight: 800; color: #059669;">{{quantidade}} {{unidade}}</span>
                      {{/each}}
                    </td>
                  </tr>
                </tbody>
              </table>
            {{/each}}
          </div>
        </div>

        <!-- Tabela: colheitas não precificadas (compra) -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">Colheitas Não Precificadas (Aguardando Precificação)</div>
          </div>
          <div class="card-body">
            {{#if tabelas.naoPrecificadas.length}}
              {{#each tabelas.naoPrecificadas}}
                <!-- Cabeçalho Cultura/Fruta -->
                <div style="background: linear-gradient(135deg, #059669 0%, #047857 100%); border-radius: 8px; padding: 10px 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <div style="background-color: rgba(255, 255, 255, 0.2); border-radius: 6px; padding: 4px 8px;">
                    <span style="color: #ffffff; font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;">CULTURA</span>
                  </div>
                  <div style="color: #ffffff; font-size: 11px; font-weight: 900; text-transform: uppercase;">{{cultura}}</div>
                  <div style="width: 2px; height: 16px; background-color: rgba(255, 255, 255, 0.3);"></div>
                  <div style="background-color: rgba(255, 255, 255, 0.2); border-radius: 6px; padding: 4px 8px;">
                    <span style="color: #ffffff; font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;">FRUTA</span>
                  </div>
                  <div style="color: #ffffff; font-size: 11px; font-weight: 900;">{{fruta}}</div>
                </div>

                <table class="table">
                  <thead>
                    <tr>
                      <th style="width: 90px;">Pedido</th>
                      <th style="width: 160px;">Área</th>
                      <th style="width: 85px;">Data</th>
                      <th style="width: 120px;" class="text-right">Quantidade</th>
                      <th style="width: 110px;" class="text-right">Venda</th>
                    </tr>
                  </thead>
                  <tbody>
                    {{#each linhas}}
                      <tr>
                        <td><strong>#{{pedido}}</strong></td>
                        <td>{{area}}</td>
                        <td>{{dataColheita}}</td>
                        <td class="text-right"><strong>{{quantidade}}</strong> {{unidade}}</td>
                        <td class="text-right">{{valorVenda}}</td>
                      </tr>
                    {{/each}}
                    <tr class="totals-row">
                      <td colspan="3" style="text-align: right; font-weight: 800;">TOTAL POR UNIDADE:</td>
                      <td colspan="2">
                        {{#each totaisPorUnidade}}
                          <span style="margin-left: 10px; font-weight: 800; color: #059669;">{{quantidade}} {{unidade}}</span>
                        {{/each}}
                      </td>
                    </tr>
                  </tbody>
                </table>
              {{/each}}
            {{else}}
              <div style="padding: 10px; color: #64748b;">Nenhuma colheita não precificada encontrada.</div>
            {{/if}}
          </div>
        </div>

      </div>
    </div>
  </div>

  {{!-- Rodapé removido - agora é gerado via displayHeaderFooter do Puppeteer --}}

</body>
</html>


