<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Boleto Bancário</title>
    <style type="text/css">
        /* RESET E BASICO */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
            -webkit-print-color-adjust: exact;
        }

        body {
            background: #fff;
            padding: 10px;
            width: 100%;
            max-width: 210mm; /* A4 width */
            margin: 0 auto;
        }

        /* UTILITARIOS */
        .w-100 { width: 100%; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .font-bold { font-weight: bold; }
        .upper { text-transform: uppercase; }
        
        /* LINHA DE CORTE */
        .corte-container {
            width: 100%;
            margin-bottom: 5px;
            clear: both;
            overflow: hidden;
        }
        .corte-texto {
            font-size: 9px;
            float: right;
            margin-bottom: 2px;
        }
        .linha-pontilhada {
            width: 100%;
            border-bottom: 1px dashed #000;
            margin-top: 12px;
        }

        /* ESTRUTURA DE TABELA */
        table.boleto-table {
            width: 100%;
            border-collapse: collapse;
            border-spacing: 0;
            border: 1px solid #000;
            border-left: none;
            border-right: none;
            margin-bottom: 15px;
        }

        table.boleto-table td {
            border-right: none;
            border-left: none;
            border-bottom: 1px solid #000;
            padding: 2px 5px;
            vertical-align: top;
            height: 26px; /* Altura mínima */
            position: relative;
            box-sizing: border-box;
        }

        .td-sem-borda-direita {
            border-right: none !important;
        }
        
        table.boleto-table tr:last-child td {
            border-bottom: none;
        }

        /* ROTULOS E VALORES */
        .label {
            font-size: 7px;
            color: #000;
            display: block;
            margin-bottom: 2px;
        }

        .value {
            font-size: 11px;
            font-weight: bold;
            color: #000;
            display: block;
            line-height: 1.1;
        }
        
        .value-sm {
            font-size: 10px;
        }

        /* CABECALHO DO BANCO */
        .header-banco {
            width: 100%;
            border-bottom: 2px solid #000;
            margin-bottom: 2px;
            display: table;
        }

        .col-logo {
            display: table-cell;
            width: 180px;
            vertical-align: bottom;
            padding-bottom: 2px;
        }
        
        .col-logo img {
            max-width: 170px;
            max-height: 35px;
        }

        .col-codigo {
            display: table-cell;
            width: 60px;
            vertical-align: bottom;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            border-left: 2px solid #000;
            border-right: 2px solid #000;
            padding-bottom: 2px;
        }

        .col-linha {
            display: table-cell;
            vertical-align: bottom;
            text-align: right;
            font-size: 15px;
            padding-bottom: 2px;
            padding-right: 2px;
            letter-spacing: 0.5px;
        }

        /* ÁREA DO TOPO (PIX + LOGO) */
        .topo-pix-logo {
            width: 100%;
            margin-bottom: 15px;
            display: table;
        }
        .topo-pix-section {
            display: table-cell;
            width: 70%;
            vertical-align: middle;
            padding-right: 15px;
        }
        .topo-logo-section {
            display: table-cell;
            width: 30%;
            vertical-align: middle;
            text-align: right;
        }
        .topo-logo-section img {
            max-width: 200px;
            max-height: 100px;
        }
        .pix-titulo {
            font-size: 16px;
            font-weight: bold;
            color: #000;
            margin-bottom: 5px;
        }
        .pix-descricao {
            font-size: 11px;
            color: #333;
            line-height: 1.4;
        }
        .pix-qr-container {
            display: inline-block;
            vertical-align: middle;
            margin-right: 15px;
        }
        .pix-qr-container img {
            width: 120px;
            height: 120px;
            border: 1px solid #ccc;
        }
        .pix-texto-container {
            display: inline-block;
            vertical-align: middle;
            width: calc(100% - 145px);
        }

        /* DIV PARA FUNDO COLORIDO DAS CELULAS - AJUSTADO */
        .cell-bg {
            width: 100%;      /* Preenche 100% da largura da TD */
            height: 100%;     /* Preenche 100% da altura da TD */
            min-height: 26px; /* Garante altura mínima igual à TD */
            margin: 0;        /* Remove margens para encostar na borda */
            padding: 2px 5px; /* Mantém o padding interno para o texto */
            display: flex;    /* Melhora o comportamento de preenchimento */
            flex-direction: column;
            justify-content: flex-start;
        }
        .cell-bg-gray {
            background-color: #f0f0f0;
        }
        .cell-bg-blue {
            background-color: #d1d5db; /* Cor de fundo cinza/azul */
        }
        
        .td-sem-borda-direita-separador {
            border-right: none !important;
        }
        
        /* BORDA AMARELA */
        .td-borda-amarela {
            position: relative;
        }
        
        table.boleto-table > tbody > tr > td.td-borda-amarela:first-child {
            border-left: none !important;
        }
        .td-borda-amarela::before {
            content: '';
            position: absolute;
            left: 0;
            top: 4%;
            bottom: 4%;
            width: 4px;
            background-color: #FFD700;
            border-radius: 0;
            z-index: 10;
        }
        
        .td-borda-amarela-direita {
            position: relative;
            border-right: none !important;
        }
        .td-borda-amarela-direita::after {
            content: '';
            position: absolute;
            right: 0;
            top: 5px;
            bottom: 5px;
            width: 4px;
            background-color: #FFD700;
            border-radius: 0;
            z-index: 10;
        }

        /* INSTRUÇÕES E CÁLCULOS */
        .calc-row {
            border-bottom: 1px solid #000;
            padding: 2px 5px;
            height: 24px;
        }
        .calc-row:last-child {
            border-bottom: none;
        }
        .calc-label { font-size: 7px; margin-bottom: 2px; }
        .calc-value { font-size: 11px; font-weight: bold; text-align: right; }

        /* FOOTER */
        .footer-boleto {
            margin-top: 10px;
            width: 100%;
            display: table;
        }
        .box-barcode {
            display: table-cell;
            vertical-align: bottom;
            padding-right: 10px;
            text-align: center;
        }
        .box-barcode img {
            width: 100%;
            height: 50px;
            max-width: 450px;
            margin: 0 auto;
            display: block;
        }
        
        /* PAGADOR BLOCK */
        .sacado-block {
            border: none;
            border-bottom: 1px solid #000;
            border-top: none;
            padding: 5px;
            padding-left: 9px;
            font-size: 10px;
            min-height: 40px;
            position: relative;
        }
        .sacado-block::before {
            content: '';
            position: absolute;
            left: 0;
            top: 4%;
            bottom: 4%;
            width: 4px;
            background-color: #FFD700;
            border-radius: 0;
            z-index: 10;
        }
    </style>
</head>
<body>

    {{#if qrCodePixBase64}}
    <div class="topo-pix-logo">
        <div class="topo-pix-section">
            <div class="pix-qr-container">
                <img src="{{qrCodePixBase64}}" alt="QR Code PIX">
            </div>
            <div class="pix-texto-container">
                <div class="pix-titulo">Pague agora com o seu Pix</div>
                <div class="pix-descricao">Para efetuar o pagamento via Pix, utilize a opção Pix do seu aplicativo e aponte a câmera do seu aparelho para o QR code ao lado.</div>
            </div>
        </div>
        <div class="topo-logo-section">
            {{#if logoPath}}
                <img src="{{logoPath}}" alt="Logo Empresa">
            {{/if}}
        </div>
    </div>
    {{else}}
    <div class="topo-pix-logo">
        <div class="topo-pix-section"></div>
        <div class="topo-logo-section">
            {{#if logoPath}}
                <img src="{{logoPath}}" alt="Logo Empresa">
            {{/if}}
        </div>
    </div>
    {{/if}}

    <div class="corte-container">
        <div class="corte-texto" style="font-weight: bold; font-size: 11px;">Recibo do Pagador</div>
    </div>

    <div class="header-banco">
        <div class="col-logo">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fb/Banco_do_Brasil_logo.svg/2560px-Banco_do_Brasil_logo.svg.png" alt="Banco do Brasil">
        </div>
        <div class="col-codigo">001-9</div>
        <div class="col-linha">{{formatarLinhaDigitavel linhaDigitavel}}</div>
    </div>

    <!-- TABELA 1: RECIBO DO PAGADOR -->
    <table class="boleto-table">
        <tr>
            <td colspan="4" rowspan="2" class="td-sem-borda-direita-separador td-borda-amarela" style="border-left: none !important;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span class="label">Nome do Pagador / Endereço</span>
                        <span class="value">{{pagador.nome}}</span>
                    </div>
                    {{#if pagador.cpfCnpj}}
                    <div style="text-align: right;">
                        <span class="label">{{pagador.tipoDocumento}}</span>
                        <span class="value" style="font-weight: normal;">{{pagador.cpfCnpj}}</span>
                    </div>
                    {{/if}}
                </div>
                <div style="margin-top: 3px; font-size: 10px;">
                    {{pagador.endereco}}, {{pagador.bairro}} - {{pagador.cidade}} / {{pagador.uf}} - CEP: {{pagador.cep}}
                </div>
            </td>
            <!-- Ajuste: padding: 0 para que a div interna encoste na borda -->
            <td colspan="2" style="padding: 0; width: 30%;" class="td-borda-amarela">
                <div class="cell-bg cell-bg-blue">
                    <span class="label">Data de Vencimento</span>
                    <span class="value text-right" style="font-weight: bold;">{{formatarData dataVencimento}}</span>
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="2" class="td-borda-amarela" style="padding-left: 8px; width: 30%;">
                <span class="label">Agência / Código Do Beneficiário</span>
                <span class="value text-right">{{conta.agencia}} / {{conta.codigoBeneficiario}}</span>
            </td>
        </tr>
        <tr>
            <td colspan="4" rowspan="2" class="td-sem-borda-direita-separador td-borda-amarela" style="border-left: none !important;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span class="label">Nome do Beneficiário / Endereço</span>
                        <span class="value">{{empresa.razao_social}}</span>
                    </div>
                    {{#if empresa.cnpjFormatado}}
                    <div style="text-align: right;">
                        <span class="label">CNPJ</span>
                        <span class="value" style="font-weight: normal;">{{empresa.cnpjFormatado}}</span>
                    </div>
                    {{/if}}
                </div>
                <div style="margin-top: 3px; font-size: 10px;">
                    {{empresa.logradouro}}, {{empresa.bairro}} - {{empresa.cidade}} / {{empresa.estado}} - CEP: {{empresa.cep}}
                </div>
            </td>
            <td colspan="2" class="td-borda-amarela" style="padding-left: 8px; width: 30%;">
                <span class="label">Nosso Número</span>
                <span class="value text-right">{{dadosBoleto.nossoNumero}}</span>
            </td>
        </tr>
        <tr>
            <!-- Ajuste: padding: 0 -->
            <td colspan="2" style="padding: 0; width: 30%;" class="td-borda-amarela">
                <div class="cell-bg cell-bg-blue">
                    <span class="label">Valor do Documento</span>
                    <span class="value text-right" style="font-weight: bold;">{{formatarMoeda valor}}</span>
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="4" style="padding: 0; border-left: none !important;" class="td-sem-borda-direita-separador td-borda-amarela">
                <table style="width: 100%; border-collapse: collapse; border: none; margin: 0;">
                    <tr>
                        <td style="border: none; padding: 2px 5px; position: relative;">
                            <span class="label">Uso do Banco</span>
                            <span class="value">&nbsp;</span>
                            <div style="position: absolute; right: 0; top: 4%; bottom: 4%; width: 4px; background-color: #FFD700; z-index: 10;"></div>
                        </td>
                        <td style="border: none; padding: 2px 5px; position: relative;">
                            <span class="label">Nr. do Documento</span>
                            <span class="value">{{dadosBoleto.numeroDocumento}}</span>
                            <div style="position: absolute; right: 0; top: 4%; bottom: 4%; width: 4px; background-color: #FFD700; z-index: 10;"></div>
                        </td>
                        <td style="border: none; padding: 2px 5px; position: relative;">
                            <span class="label">Espécie Doc</span>
                            <span class="value">DM</span>
                            <div style="position: absolute; right: 0; top: 4%; bottom: 4%; width: 4px; background-color: #FFD700; z-index: 10;"></div>
                        </td>
                        <td style="border: none; padding: 2px 5px; position: relative;">
                            <span class="label">Aceite</span>
                            <span class="value">N</span>
                            <div style="position: absolute; right: 0; top: 4%; bottom: 4%; width: 4px; background-color: #FFD700; z-index: 10;"></div>
                        </td>
                        <td style="border: none; padding: 2px 5px;">
                            <span class="label">Data Processamento</span>
                            <span class="value">{{formatarData dadosBoleto.dataProcessamento}}</span>
                        </td>
                    </tr>
                </table>
            </td>
            <td colspan="2" class="td-borda-amarela" style="padding-left: 8px; width: 30%;">
                <span class="label">(=) Valor Pago</span>
                <span class="value text-right">&nbsp;</span>
            </td>
        </tr>
    </table>
    
    <br><br>

    <div class="corte-container">
        <div class="corte-texto" style="float:left;">Corte na linha pontilhada</div>
        <div class="linha-pontilhada"></div>
    </div>

    <div class="header-banco">
        <div class="col-logo">
             <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fb/Banco_do_Brasil_logo.svg/2560px-Banco_do_Brasil_logo.svg.png" alt="Banco do Brasil">
        </div>
        <div class="col-codigo">001-9</div>
        <div class="col-linha">{{formatarLinhaDigitavel linhaDigitavel}}</div>
    </div>

    <!-- TABELA 2: FICHA DE COMPENSAÇÃO -->
    <table class="boleto-table" style="margin-bottom: 0;">
        <tr>
            <td colspan="5" class="td-sem-borda-direita-separador td-borda-amarela">
                <span class="label">Local do Pagamento</span>
                <span class="value">Pagar preferencialmente nos canais de autoatendimento do Banco do Brasil.</span>
            </td>
            <!-- Ajuste: padding: 0 -->
            <td style="width: 30%; padding: 0;" class="td-borda-amarela">
                <div class="cell-bg cell-bg-blue">
                    <span class="label">Data de Vencimento</span>
                    <span class="value text-right" style="font-weight: bold;">{{formatarData dataVencimento}}</span>
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="5" class="td-sem-borda-direita-separador td-borda-amarela">
                <span class="label">Nome do Beneficiário</span>
                <span class="value">{{empresa.razao_social}} (CNPJ: {{empresa.cnpj}})</span>
            </td>
            <td style="width: 30%; padding-left: 8px;" class="td-borda-amarela">
                <span class="label">Agência / Código do Beneficiário</span>
                <span class="value text-right">{{conta.agencia}} / {{conta.codigoBeneficiario}}</span>
            </td>
        </tr>
        <tr>
            <td style="width: 15%;" class="td-borda-amarela">
                <span class="label">Data do Documento</span>
                <span class="value">{{formatarData dadosBoleto.dataDocumento}}</span>
            </td>
            <td style="width: 20%;" class="td-borda-amarela">
                <span class="label">Nº do Documento</span>
                <span class="value">{{dadosBoleto.numeroDocumento}}</span>
            </td>
            <td style="width: 10%;" class="td-borda-amarela">
                <span class="label">Espécie Doc.</span>
                <span class="value">{{dadosBoleto.especieDoc}}</span>
            </td>
            <td style="width: 8%;" class="td-borda-amarela">
                <span class="label">Aceite</span>
                <span class="value">N</span>
            </td>
            <td style="width: 17%;" class="td-sem-borda-direita-separador td-borda-amarela">
                <span class="label">Data Processamento</span>
                <span class="value">{{formatarData dadosBoleto.dataProcessamento}}</span>
            </td>
            <td style="width: 30%; padding-left: 8px;" class="td-borda-amarela">
                <span class="label">Nosso Número</span>
                <span class="value text-right">{{dadosBoleto.nossoNumero}}</span>
            </td>
        </tr>
        <tr>
            <td class="td-borda-amarela">
                <span class="label">Uso do Banco</span>
                <span class="value">&nbsp;</span>
            </td>
            <td class="td-borda-amarela">
                <span class="label">Carteira</span>
                <span class="value">{{conta.carteira}}</span>
            </td>
            <td class="td-borda-amarela">
                <span class="label">Espécie</span>
                <span class="value">R$</span>
            </td>
            <td class="td-borda-amarela">
                <span class="label">Quantidade</span>
                <span class="value">&nbsp;</span>
            </td>
            <td class="td-sem-borda-direita-separador td-borda-amarela">
                <span class="label">(x) Valor</span>
                <span class="value">&nbsp;</span>
            </td>
            <!-- Ajuste: padding: 0 -->
            <td style="width: 30%; padding: 0;" class="td-borda-amarela">
                <div class="cell-bg cell-bg-blue">
                    <span class="label">(=) Valor do Documento</span>
                    <span class="value text-right" style="font-weight: bold;">{{formatarMoeda valor}}</span>
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="5" rowspan="3" style="padding: 5px; vertical-align: top;" class="td-sem-borda-direita-separador td-borda-amarela">
                <span class="label">Instruções (Texto de Responsabilidade do Beneficiário)</span>
                <div style="margin-top: 5px; font-size: 10px; line-height: 1.3;">
                    {{#if dadosBoleto.instrucoes}}
                        <p>{{dadosBoleto.instrucoes}}</p>
                    {{/if}}
                </div>
            </td>
            <td style="width: 30%; padding: 0; padding-left: 8px;" class="td-borda-amarela">
                <div style="padding: 2px 5px; height: 24px;">
                    <div class="calc-label">(-) Desconto / Abatimento</div>
                    <div class="calc-value">{{formatarMoeda desconto}}</div>
                </div>
            </td>
        </tr>
        <tr>
            <td style="width: 30%; padding: 0; padding-left: 8px;" class="td-borda-amarela">
                <div style="padding: 2px 5px; height: 24px;">
                    <div class="calc-label">(+) Juros/Multa</div>
                    <div class="calc-value">{{formatarMoeda jurosMulta}}</div>
                </div>
            </td>
        </tr>
        <tr>
            <!-- Ajuste: padding: 0 -->
            <td style="width: 30%; padding: 0; border-bottom: none !important;" class="td-borda-amarela">
                <div class="cell-bg cell-bg-blue">
                    <div class="calc-label">(=) Valor Cobrado</div>
                    <div class="calc-value">{{formatarMoeda valorCobrado}}</div>
                </div>
            </td>
        </tr>
    </table>

    <div class="sacado-block">
        <span class="label">Pagador</span>
        <div style="margin-top: 2px;">
            <span class="font-bold">{{pagador.nome}}</span> - CPF/CNPJ: {{pagador.cpfCnpj}}
        </div>
        <div style="margin-top: 2px;">
            {{pagador.endereco}}, {{pagador.bairro}} - {{pagador.cidade}} / {{pagador.uf}} - CEP: {{pagador.cep}}
        </div>
    </div>
    <div style="font-size: 8px; margin-top: 5px; text-align: right;">Autenticação mecânica - Ficha de Compensação</div>

    <div class="footer-boleto">
        <div class="box-barcode">
            {{#if barcodeBase64}}
                <img src="{{barcodeBase64}}" alt="Código de Barras" style="width: 100%; max-width: 450px; height: 50px;">
            {{else}}
                <div style="height:50px; background: #eee; text-align:center; padding-top:15px; font-size:10px;">CÓDIGO DE BARRAS AQUI</div>
            {{/if}}
        </div>
    </div>

</body>
</html>